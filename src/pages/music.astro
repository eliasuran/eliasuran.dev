---
import BaseLayout from "../layouts/BaseLayout.astro";
import {
  getTopTracks,
  getTopArtists,
  getAccessToken,
  getCurrentlyPlaying,
} from "../lib/music";

import type { CurrentlyPlaying, Track, Artist } from "../lib/music";

const token = await getAccessToken();

const currentlyPlaying: CurrentlyPlaying = await getCurrentlyPlaying(token);
console.log(currentlyPlaying);

const tracks: Track[] = await getTopTracks(token);

const artists: Artist[] = await getTopArtists(token);
---

<BaseLayout
  title="Musikk - eliasuran.dev"
  desc="my favorite artists and tracks"
>
  <div class="flex flex-col gap-4 my-8">
    {
      currentlyPlaying.is_playing ? (
        <>
          <h1 class="text-base-content text-3xl">Currently Playing</h1>
          <div class="h-32 w-12 bg-base-200 shadow-md shadow-base-200" />
          <h1>Listening to {currentlyPlaying.data.name}</h1>
        </>
      ) : (
        <h1 class="text-base-content text-3xl">
          Currently Not Listening to Music
        </h1>
      )
    }

    <h1 class="text-base-content text-3xl">Top Tracks</h1>
    {
      tracks.map((track) => (
        <div class="flex sm:flex-row flex-col gap-2">
          <img
            src={track.album.images[0].url}
            alt={`Cover art for ${track.album} by ${track.artists}`}
            class="h-24 w-24 aspect-square"
          />
          <div class="sm:self-end self-start">
            <a
              href={track.external_urls.spotify}
              class="text-xl text-base-content"
            >
              {track.name}
            </a>
            <p>{track.artists.map((artist) => artist.name).join(", ")}</p>
          </div>
        </div>
      ))
    }
  </div>

  <div class="flex flex-col gap-4 my-8">
    <h1 class="text-base-content text-3xl">Top Artists</h1>
    {
      artists.map((artist) => (
        <div class="flex sm:flex-row flex-col gap-2">
          <img
            src={artist.images[0].url}
            alt={`Photo of ${artist.name}`}
            class="flex gap-2 h-24 w-24"
          />
          <a
            href={artist.external_urls.spotify}
            class="text-xl text-base-content sm:self-end self-start"
          >
            {artist.name}
          </a>
        </div>
      ))
    }
  </div>
</BaseLayout>
